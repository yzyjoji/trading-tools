<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Binance Futures Margin & Cost Calculator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #000000;
            --surface: #0a0a0a;
            --accent: #ffffff;
            --muted: #444444;
            --dim: #1a1a1a;
            --border-color: #333;
            --highlight: #f0b90b;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            margin: 0;
            padding: 2rem;
            background: var(--bg);
            color: var(--accent);
            min-height: 100vh;
            overflow-y: auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 2rem;
            font-weight: 200;
            font-size: 2rem;
            color: var(--accent);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        @media (max-width: 900px) {
            .container {
                grid-template-columns: 1fr;
            }
        }

        .tool-box {
            background: var(--surface);
            border: 1px solid var(--dim);
            padding: 2rem;
            height: fit-content;
        }

        .tool-header {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--dim);
            color: var(--highlight);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .section-title {
            font-size: 0.85rem;
            font-weight: 500;
            margin-top: 1.5rem;
            margin-bottom: 0.8rem;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            opacity: 0.8;
        }

        label {
            display: block;
            margin-top: 1rem;
            margin-bottom: 0.4rem;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--muted);
        }

        .row {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .col {
            flex: 1;
            min-width: 140px;
        }

        input[type="number"],
        select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--dim);
            background: var(--bg);
            color: var(--accent);
            font-family: 'Inter', monospace;
            font-size: 0.9rem;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }

        input[type="number"]:focus,
        select:focus {
            border-color: var(--muted);
            outline: none;
        }

        .radio-group {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .radio-group label {
            cursor: pointer;
            color: var(--accent);
            text-transform: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            opacity: 0.7;
            font-size: 0.8rem;
        }

        .radio-group label:hover {
            opacity: 1;
        }

        .radio-group input {
            margin: 0;
        }

        button {
            padding: 1rem;
            font-size: 0.9rem;
            background-color: var(--accent);
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: var(--bg);
            text-transform: uppercase;
            transition: opacity 0.3s;
            width: 100%;
            margin-top: 1.5rem;
        }

        button.secondary {
            background-color: var(--dim);
            color: var(--accent);
            border: 1px solid var(--muted);
            margin-top: 1rem;
            padding: 0.8rem;
            font-size: 0.8rem;
        }

        button:hover {
            opacity: 0.8;
        }

        .order-list {
            margin-top: 1rem;
            border: 1px solid var(--dim);
            padding: 0.5rem;
            background: var(--bg);
        }

        .order-item {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 0.5rem;
            align-items: end;
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--dim);
        }

        .order-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .remove-btn {
            background: transparent;
            color: #ff4444;
            width: auto;
            padding: 0 0.5rem;
            margin: 0;
            font-size: 1.2rem;
            height: 100%;
            display: flex;
            align-items: center;
        }

        .result-box {
            margin-top: 1.5rem;
            padding: 1rem;
            background: var(--bg);
            border: 1px solid var(--dim);
            white-space: pre-wrap;
            font-family: 'Inter', monospace;
            line-height: 1.5;
            font-size: 0.9rem;
        }

        .hidden {
            display: none;
        }

        .note {
            font-size: 0.65rem;
            color: var(--muted);
            margin-top: 0.2rem;
        }
    </style>
</head>

<body>
    <h1>Margin & Cost Calculator</h1>

    <div class="container">
        <!-- TOOL 1: MARGIN REQUIREMENT -->
        <div class="tool-box" id="marginTool">
            <div class="tool-header">Margin Requirement</div>
            <form id="marginForm">
                <!-- Config -->
                <div class="row">
                    <div class="col">
                        <label>Contract Type</label>
                        <div class="radio-group" name="marginContractType">
                            <label><input type="radio" name="m_type" value="usdm" checked> USDⓈ-M</label>
                            <label><input type="radio" name="m_type" value="coinm"> Coin-M</label>
                        </div>
                    </div>
                    <div class="col">
                        <label>Position Mode</label>
                        <div class="radio-group" name="marginPosMode">
                            <label><input type="radio" name="m_mode" value="oneway" checked> One-Way</label>
                            <label><input type="radio" name="m_mode" value="hedge"> Hedge</label>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <label>Mark Price</label>
                        <input type="number" id="m_markPrice" step="any" required>
                    </div>
                    <div class="col">
                        <label>Leverage (x)</label>
                        <input type="number" id="m_leverage" value="10" required>
                    </div>
                </div>

                <div id="m_coinmFields" class="hidden row">
                    <div class="col">
                        <label>Contract Value (USD)</label>
                        <input type="number" id="m_contractVal" placeholder="e.g. 100">
                    </div>
                </div>

                <!-- One-Way Existing Position -->
                <div id="m_onewayPos">
                    <div class="section-title">Existing Position (One-Way)</div>
                    <div class="row">
                        <div class="col">
                            <label>Size <span class="m_unit">(Coin)</span></label>
                            <input type="number" id="m_ow_size" value="0">
                        </div>
                        <div class="col">
                            <label>Side</label>
                            <select id="m_ow_side">
                                <option value="LONG">Long</option>
                                <option value="SHORT">Short</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Hedge Existing Position -->
                <div id="m_hedgePos" class="hidden">
                    <div class="section-title">Existing Positions (Hedge)</div>
                    <div class="row">
                        <div class="col">
                            <label>Long Pos Size</label>
                            <input type="number" id="m_h_longSize" value="0">
                        </div>
                        <div class="col">
                            <label>Short Pos Size</label>
                            <input type="number" id="m_h_shortSize" value="0">
                        </div>
                    </div>
                </div>

                <!-- Open Orders -->
                <div class="section-title">Open Orders</div>
                <div id="m_orders" class="order-list"></div>
                <button type="button" class="secondary" id="m_addOrderBtn">+ Add Open Order</button>

                <button type="button" id="m_calcBtn">Calculate Margin Req</button>

                <div id="m_result" class="result-box hidden"></div>
            </form>
        </div>

        <!-- TOOL 2: COST CALCULATOR -->
        <div class="tool-box" id="costTool">
            <div class="tool-header">Cost Calculator</div>
            <p style="font-size:0.8rem; color:var(--muted); margin-bottom:1rem;">
                Calculates Initial Margin + Open Loss for a <strong>New Open Order</strong>.
            </p>
            <form id="costForm">
                <div class="row">
                    <div class="col">
                        <label>Contract Type</label>
                        <div class="radio-group">
                            <label><input type="radio" name="c_type" value="usdm" checked> USDⓈ-M</label>
                            <label><input type="radio" name="c_type" value="coinm"> Coin-M</label>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <label>Mark Price</label>
                        <input type="number" id="c_markPrice" step="any" required>
                    </div>
                    <div class="col">
                        <label>Leverage (x)</label>
                        <input type="number" id="c_leverage" value="10" required>
                    </div>
                </div>

                <div id="c_coinmFields" class="hidden row">
                    <div class="col">
                        <label>Contract Value (USD)</label>
                        <input type="number" id="c_contractVal" placeholder="e.g. 100">
                    </div>
                </div>

                <div class="section-title">New Order Details</div>
                <div class="row">
                    <div class="col">
                        <label>Order Size <span class="c_unit">(Coin)</span></label>
                        <input type="number" id="c_size" step="any" required>
                    </div>
                    <div class="col">
                        <label>Limit Price</label>
                        <input type="number" id="c_price" step="any" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <label>Side</label>
                        <select id="c_side">
                            <option value="BUY">Buy / Long</option>
                            <option value="SELL">Sell / Short</option>
                        </select>
                    </div>
                </div>

                <button type="button" id="c_calcBtn">Calculate Cost</button>
                <div id="c_result" class="result-box hidden"></div>
            </form>
        </div>
    </div>

    <footer style="text-align:center; margin-top:3rem; font-size:0.7rem; color:var(--muted);">
        <a href="index.html" style="color:var(--muted); text-decoration:none;">&larr; Back to Tools</a>
    </footer>

    <script>
        /* ================= MARGIN TOOL LOGIC ================= */
        const mTypeRadios = document.getElementsByName('m_type');
        const mModeRadios = document.getElementsByName('m_mode');
        const mCoinmFields = document.getElementById('m_coinmFields');
        const mOneWayPosDiv = document.getElementById('m_onewayPos');
        const mHedgePosDiv = document.getElementById('m_hedgePos');
        const mOrdersDiv = document.getElementById('m_orders');
        const mResult = document.getElementById('m_result');
        const mUnits = document.querySelectorAll('.m_unit');

        let mOrderCounter = 0;

        function updateM_UI() {
            const type = Array.from(mTypeRadios).find(r => r.checked).value;
            const mode = Array.from(mModeRadios).find(r => r.checked).value;

            if (type === 'coinm') {
                mCoinmFields.classList.remove('hidden');
                mUnits.forEach(u => u.textContent = "(Cont)");
            } else {
                mCoinmFields.classList.add('hidden');
                mUnits.forEach(u => u.textContent = "(Coin)");
            }

            if (mode === 'hedge') {
                mOneWayPosDiv.classList.add('hidden');
                mHedgePosDiv.classList.remove('hidden');
            } else {
                mOneWayPosDiv.classList.remove('hidden');
                mHedgePosDiv.classList.add('hidden');
            }
            // Clear orders when mode changes to prevent confusion
            mOrdersDiv.innerHTML = '';
            addM_Order();
        }

        mTypeRadios.forEach(r => r.addEventListener('change', updateM_UI));
        mModeRadios.forEach(r => r.addEventListener('change', updateM_UI));

        function addM_Order() {
            const id = mOrderCounter++;
            const mode = Array.from(mModeRadios).find(r => r.checked).value;

            const div = document.createElement('div');
            div.className = 'order-item';
            div.id = `m_order_${id}`;

            let typeOptions = '';
            if (mode === 'oneway') {
                typeOptions = `
                    <option value="BUY">Buy</option>
                    <option value="SELL">Sell</option>
                 `;
            } else {
                typeOptions = `
                    <option value="OPEN_LONG">Open Long</option>
                    <option value="CLOSE_LONG">Close Long</option>
                    <option value="OPEN_SHORT">Open Short</option>
                    <option value="CLOSE_SHORT">Close Short</option>
                 `;
            }

            div.innerHTML = `
                <div class="col">
                    <label>Size</label>
                    <input type="number" class="o-size" placeholder="0">
                </div>
                <div class="col">
                    <label>Limit Price</label>
                    <input type="number" class="o-price" placeholder="0">
                </div>
                <div class="col">
                    <label>Type</label>
                    <select class="o-type">
                        ${typeOptions}
                    </select>
                </div>
                <button type="button" class="remove-btn" onclick="removeM_Order(${id})">&times;</button>
            `;
            mOrdersDiv.appendChild(div);
        }

        window.removeM_Order = (id) => {
            const el = document.getElementById(`m_order_${id}`);
            if (el) el.remove();
        };

        document.getElementById('m_addOrderBtn').addEventListener('click', addM_Order);

        document.getElementById('m_calcBtn').addEventListener('click', () => {
            const type = Array.from(mTypeRadios).find(r => r.checked).value;
            const mode = Array.from(mModeRadios).find(r => r.checked).value;
            const markPrice = parseFloat(document.getElementById('m_markPrice').value);
            const leverage = parseFloat(document.getElementById('m_leverage').value);
            const contractVal = (type === 'coinm') ? parseFloat(document.getElementById('m_contractVal').value) : 1;

            if (!markPrice || !leverage) {
                alert("Please enter Mark Price and Leverage.");
                return;
            }
            if (type === 'coinm' && !contractVal) {
                alert("Please enter Contract Value for Coin-M.");
                return;
            }

            const getPosNotional = (size) => {
                if (type === 'usdm') return size * markPrice;
                return (size * contractVal) / markPrice;
            };

            const getOrderValue = (size, price) => {
                if (type === 'usdm') return size * price;
                return (size * contractVal) / price;
            };

            // Gather Orders
            let longBidVal = 0; // Buy / Open Long
            let longAskVal = 0; // Sell / Close Long
            let shortBidVal = 0; // Close Short
            let shortAskVal = 0; // Open Short

            let logOrders = [];

            const orderRows = mOrdersDiv.querySelectorAll('.order-item');
            orderRows.forEach(row => {
                const s = parseFloat(row.querySelector('.o-size').value) || 0;
                const p = parseFloat(row.querySelector('.o-price').value) || 0;
                const t = row.querySelector('.o-type').value;

                if (s > 0 && p > 0) {
                    const val = getOrderValue(s, p);
                    let category = "";

                    if (mode === 'oneway') {
                        if (t === 'BUY') { longBidVal += val; category = "Bid/Buy (+)"; }
                        else { longAskVal += val; category = "Ask/Sell (-)"; }
                    } else {
                        if (t === 'OPEN_LONG') { longBidVal += val; category = "Long Bid (Open Long)"; }
                        if (t === 'CLOSE_LONG') { longAskVal += val; category = "Long Ask (Close Long)"; }
                        if (t === 'CLOSE_SHORT') { shortBidVal += val; category = "Short Bid (Close Short)"; }
                        if (t === 'OPEN_SHORT') { shortAskVal += val; category = "Short Ask (Open Short)"; }
                    }
                    logOrders.push(`- Order: ${t}, Size: ${s}, Price: ${p} => Value: ${val.toFixed(2)} (${category})`);
                }
            });

            // Calculate
            let resultHtml = "";
            let logDetails = [`Calculation Details (${mode.toUpperCase()} Mode):`, "-----------------------"];
            logDetails.push(`Market: ${type.toUpperCase()}, Mark Price: ${markPrice}, Leverage: ${leverage}x`);
            logDetails.push(...logOrders);
            logDetails.push("");

            if (mode === 'oneway') {
                const size = parseFloat(document.getElementById('m_ow_size').value) || 0;
                const side = document.getElementById('m_ow_side').value;
                let absPosNotional = getPosNotional(size);
                let rawPosNotional = (side === 'LONG') ? absPosNotional : -absPosNotional;

                logDetails.push(`Position: ${side}, Size: ${size} => Notional: ${rawPosNotional.toFixed(2)}`);
                logDetails.push(`Total Bid Value (Buy): ${longBidVal.toFixed(2)}`);
                logDetails.push(`Total Ask Value (Sell): ${longAskVal.toFixed(2)}`);
                logDetails.push("");

                // Formula Log
                const term1Inner = rawPosNotional + longBidVal;
                const term1 = Math.abs(term1Inner);
                const term2Inner = rawPosNotional - longAskVal;
                const term2 = Math.abs(term2Inner);
                const req = Math.max(term1, term2) / leverage;

                logDetails.push(`Formula: Max(Abs(Pos + Bid), Abs(Pos - Ask)) / Lev`);
                logDetails.push(`Term 1: Abs(${rawPosNotional.toFixed(2)} + ${longBidVal.toFixed(2)}) = Abs(${term1Inner.toFixed(2)}) = ${term1.toFixed(2)}`);
                logDetails.push(`Term 2: Abs(${rawPosNotional.toFixed(2)} - ${longAskVal.toFixed(2)}) = Abs(${term2Inner.toFixed(2)}) = ${term2.toFixed(2)}`);
                logDetails.push(`Max(${term1.toFixed(2)}, ${term2.toFixed(2)}) = ${Math.max(term1, term2).toFixed(2)}`);
                logDetails.push(`Margin Requirement = ${Math.max(term1, term2).toFixed(2)} / ${leverage} = ${req.toFixed(5)}`);

                resultHtml = `<strong>Margin Requirement: ${req.toFixed(5)} ${type === 'usdm' ? 'USDT' : 'Coin'}</strong>`;
            }
            else {
                // Hedge
                const lSize = parseFloat(document.getElementById('m_h_longSize').value) || 0;
                const sSize = parseFloat(document.getElementById('m_h_shortSize').value) || 0;

                const lNotional = getPosNotional(lSize);
                const sNotional = -getPosNotional(sSize);

                logDetails.push(`Long Pos Size: ${lSize} => Notional: ${lNotional.toFixed(2)}`);
                logDetails.push(`Short Pos Size: ${sSize} => Notional: ${sNotional.toFixed(2)}`);
                logDetails.push("");

                // Long Side
                const l_term1Inner = lNotional + longBidVal;
                const l_term1 = Math.abs(l_term1Inner);
                const l_term2Inner = lNotional - longAskVal;
                const l_term2 = Math.abs(l_term2Inner);
                const longReq = Math.max(l_term1, l_term2) / leverage;

                logDetails.push("[Long Side Calculation]");
                logDetails.push(`Long Bid (Open Long Orders): ${longBidVal.toFixed(2)}`);
                logDetails.push(`Long Ask (Close Long Orders): ${longAskVal.toFixed(2)}`);
                logDetails.push(`Term 1: Abs(${lNotional.toFixed(2)} + ${longBidVal.toFixed(2)}) = ${l_term1.toFixed(2)}`);
                logDetails.push(`Term 2: Abs(${lNotional.toFixed(2)} - ${longAskVal.toFixed(2)}) = ${l_term2.toFixed(2)}`);
                logDetails.push(`Long Req = Max(${l_term1.toFixed(2)}, ${l_term2.toFixed(2)}) / ${leverage} = ${longReq.toFixed(5)}`);
                logDetails.push("");

                // Short Side
                const s_term1Inner = sNotional + shortBidVal;
                const s_term1 = Math.abs(s_term1Inner);
                const s_term2Inner = sNotional - shortAskVal;
                const s_term2 = Math.abs(s_term2Inner);
                const shortReq = Math.max(s_term1, s_term2) / leverage;

                logDetails.push("[Short Side Calculation]");
                logDetails.push(`Short Bid (Close Short Orders): ${shortBidVal.toFixed(2)}`);
                logDetails.push(`Short Ask (Open Short Orders): ${shortAskVal.toFixed(2)}`);
                logDetails.push(`Term 1: Abs(${sNotional.toFixed(2)} + ${shortBidVal.toFixed(2)}) = Abs(${s_term1Inner.toFixed(2)}) = ${s_term1.toFixed(2)}`);
                logDetails.push(`Term 2: Abs(${sNotional.toFixed(2)} - ${shortAskVal.toFixed(2)}) = Abs(${s_term2Inner.toFixed(2)}) = ${s_term2.toFixed(2)}`);
                logDetails.push(`Short Req = Max(${s_term1.toFixed(2)}, ${s_term2.toFixed(2)}) / ${leverage} = ${shortReq.toFixed(5)}`);

                const total = longReq + shortReq;
                logDetails.push("");
                logDetails.push(`Total Margin = Long (${longReq.toFixed(5)}) + Short (${shortReq.toFixed(5)}) = ${total.toFixed(5)}`);

                resultHtml = `<strong>Total Margin Requirement: ${total.toFixed(5)}</strong><br><small>(Long: ${longReq.toFixed(5)} + Short: ${shortReq.toFixed(5)})</small>`;
            }

            const finalText = logDetails.join("\n");
            mResult.innerHTML = `
                <div style="margin-bottom:1rem; font-size:1.1rem;">${resultHtml}</div>
                <div style="font-size:0.8rem; border-top:1px solid #333; padding-top:1rem; color:#888;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.5rem;">
                         <span>Calculation Details:</span>
                         <button onclick="copyToClipboard(\`${finalText.replace(/`/g, "\\`")}\`)" style="width:auto; padding:0.2rem 0.5rem; margin:0; font-size:0.7rem;">Copy</button>
                    </div>
                    <pre style="white-space:pre-wrap; font-family:monospace; background:#000; padding:0.5rem;">${finalText}</pre>
                </div>
            `;
            mResult.classList.remove('hidden');
        });

        updateM_UI();

        /* ================= COST TOOL LOGIC ================= */
        const cTypeRadios = document.getElementsByName('c_type');
        const cCoinmFields = document.getElementById('c_coinmFields');
        const cUnits = document.querySelectorAll('.c_unit');
        const cResult = document.getElementById('c_result');

        function updateC_UI() {
            const type = Array.from(cTypeRadios).find(r => r.checked).value;
            if (type === 'coinm') {
                cCoinmFields.classList.remove('hidden');
                cUnits.forEach(u => u.textContent = "(Cont)");
            } else {
                cCoinmFields.classList.add('hidden');
                cUnits.forEach(u => u.textContent = "(Coin)");
            }
        }
        cTypeRadios.forEach(r => r.addEventListener('change', updateC_UI));

        document.getElementById('c_calcBtn').addEventListener('click', () => {
            const type = Array.from(cTypeRadios).find(r => r.checked).value;
            const markPrice = parseFloat(document.getElementById('c_markPrice').value);
            const leverage = parseFloat(document.getElementById('c_leverage').value);
            const size = parseFloat(document.getElementById('c_size').value);
            const price = parseFloat(document.getElementById('c_price').value);
            const side = document.getElementById('c_side').value;
            const contractVal = (type === 'coinm') ? parseFloat(document.getElementById('c_contractVal').value) : 1;

            if (!markPrice || !leverage || !size || !price) {
                alert("Please fill all fields.");
                return;
            }
            if (type === 'coinm' && !contractVal) {
                alert("Please enter Contract Value.");
                return;
            }

            let orderVal = 0;
            if (type === 'usdm') orderVal = size * price;
            else orderVal = (size * contractVal) / price;

            const initMargin = orderVal / leverage;

            let pnl = 0;
            if (type === 'usdm') {
                if (side === 'BUY') pnl = (markPrice - price) * size;
                else pnl = (price - markPrice) * size;
            } else {
                if (side === 'BUY') pnl = size * contractVal * (1 / price - 1 / markPrice);
                else pnl = size * contractVal * (1 / markPrice - 1 / price);
            }

            const openLoss = (pnl < 0) ? Math.abs(pnl) : 0;
            const totalCost = initMargin + openLoss;

            const cur = (type === 'usdm') ? 'USDT' : 'Coin';

            const logDetails = `Cost Calculation:\n----------------\nInitial Margin (OrderVal/Lev):Val ${orderVal.toFixed(2)} / ${leverage} = ${initMargin.toFixed(4)}\nEst. PnL (Mark vs Limit): ${pnl.toFixed(4)}\nOpen Loss (Max(0, -PnL)): ${openLoss.toFixed(4)}\n\nTotal Cost = ${initMargin.toFixed(4)} + ${openLoss.toFixed(4)} = ${totalCost.toFixed(4)}`;

            cResult.innerHTML = `
                <div style="margin-bottom:1rem; font-size:1.1rem;"><strong>Cost Required: ${totalCost.toFixed(5)} ${cur}</strong></div>
                <div style="font-size:0.8rem; border-top:1px solid #333; padding-top:1rem; color:#888;">
                     <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.5rem;">
                         <span>Calculation Details:</span>
                         <button onclick="copyToClipboard(\`${logDetails.replace(/`/g, "\\`")}\`)" style="width:auto; padding:0.2rem 0.5rem; margin:0; font-size:0.7rem;">Copy</button>
                    </div>
                    <pre style="white-space:pre-wrap; font-family:monospace; background:#000; padding:0.5rem;">${logDetails}</pre>
                </div>
             `;
            cResult.classList.remove('hidden');
        });

        // Global Copy Function
        window.copyToClipboard = (text) => {
            navigator.clipboard.writeText(text).then(() => {
                alert("Details copied!");
            });
        }

        updateC_UI();
        updateM_UI();
    </script>
</body>

</html>